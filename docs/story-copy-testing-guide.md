# 脚本コピー機能 動作確認ガイド

## 前提条件
- 開発サーバーが起動していること（`npm run dev`）
- ログイン済みであること
- 少なくとも1つの脚本が「脚本生成済み」または「完了」ステータスであること

## 動作確認手順

### 1. 基本的な動作確認

1. **脚本一覧画面へアクセス**
   - URL: `http://localhost:3000/stories`
   - ログインしていない場合はログイン画面へリダイレクトされます

2. **コピーボタンの表示確認**
   - `completed`（完了）ステータスの脚本カードにのみコピーボタンが表示されることを確認
   - `draft`（下書き）、`script_generated`（脚本生成済み）、`processing`（処理中）、`error`（エラー）ステータスの脚本にはコピーボタンが表示されないことを確認

3. **コピー機能の実行**
   - コピーボタン（📋アイコン）をクリック
   - ローディングスピナーが表示されることを確認
   - 新しい脚本の編集画面へ自動的に遷移することを確認（成功時はトーストメッセージなし）

4. **コピーされた脚本の確認**
   - タイトルが「{元のタイトル} (コピー)」になっていることを確認
   - ストーリー内容が正しくコピーされていることを確認
   - 脚本内容（シーン）が正しくコピーされていることを確認
   - ステータスが「脚本生成済み」になっていることを確認

### 2. エラーケースの確認

1. **ネットワークエラー**
   - 開発者ツールでネットワークタブを開き、オフラインモードにする
   - コピーボタンをクリック
   - 「脚本のコピーに失敗しました」というエラーメッセージが表示されることを確認

2. **権限エラー（他ユーザーの脚本）**
   - データベースで他のユーザーの脚本IDを確認（テスト環境の場合）
   - URLを直接叩いてAPIを呼び出す
   - 404エラーが返されることを確認

### 3. パフォーマンスの確認

1. **レスポンスタイム**
   - 開発者ツールのネットワークタブでAPIのレスポンスタイムを確認
   - 通常は1秒以内に完了することを確認

2. **UI/UXの確認**
   - コピー中は該当のボタンのみがローディング状態になることを確認
   - 他の脚本のコピーボタンは操作可能なままであることを確認

### 4. 連続動作の確認

1. **同じ脚本を複数回コピー**
   - 同じ脚本を連続してコピーできることを確認
   - 各コピーが独立した新しい脚本として作成されることを確認

2. **複数の脚本を連続でコピー**
   - 異なる脚本を素早く連続でコピー
   - 各操作が正しく処理されることを確認

## APIテスト（開発者向け）

### curl を使用した直接的なAPIテスト

```bash
# 環境変数の設定
STORY_ID="your-story-id-here"
UID="your-uid-here"

# APIを直接呼び出し
curl -X POST http://localhost:3000/api/stories/${STORY_ID}/copy \
  -H "X-User-UID: ${UID}" \
  -H "Content-Type: application/json"
```

期待される応答:
```json
{
  "success": true,
  "data": {
    "story": {
      "id": "new-story-id",
      "title": "元のタイトル (コピー)",
      "status": "script_generated",
      ...
    }
  },
  "message": "Story copied successfully",
  "timestamp": "2024-07-04T00:00:00.000Z"
}
```

## トラブルシューティング

### コピーボタンが表示されない
- 脚本のステータスが`script_generated`または`completed`であることを確認
- ブラウザのキャッシュをクリアして再読み込み

### コピーに失敗する
- ブラウザのコンソールでエラーメッセージを確認
- ネットワークタブでAPIレスポンスを確認
- サーバーログでエラーの詳細を確認

### コピー後の遷移がうまくいかない
- 新しい脚本のIDが正しく返されているか確認
- ルーティングの設定を確認

## 確認チェックリスト

- [ ] コピーボタンが適切な脚本にのみ表示される
- [ ] コピー処理中のローディング表示が正しく動作する
- [ ] コピー成功時は静かに編集画面へ遷移する（トーストなし）
- [ ] 新しい脚本の編集画面へ正しく遷移する
- [ ] コピーされた脚本の内容が正しい
- [ ] エラー時のトーストメッセージが適切に表示される
- [ ] 連続操作でも問題なく動作する