# Showgeki2 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Showgeki2ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆã€ãŠã‚ˆã³å„ç¨®ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ã®ä½¿ç”¨æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

- [åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ](#åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ)
- [ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ](#ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ)
- [ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ](#ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ)
- [ãƒ¢ãƒƒã‚¯æ©Ÿèƒ½](#ãƒ¢ãƒƒã‚¯æ©Ÿèƒ½)
- [ãƒ‡ãƒãƒƒã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒ‡ãƒãƒƒã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [CI/CD ã§ã®ä½¿ç”¨](#cicd-ã§ã®ä½¿ç”¨)

## ğŸš€ åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# ä¸€å›ã®ã¿å®Ÿè¡Œï¼ˆCIç”¨ï¼‰
npm run test:run

# UIãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§å¯è¦–åŒ–ï¼‰
npm run test:ui
```

### ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆ

```bash
# å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚¹ãƒˆ
npm test tests/unit/lib/uid.test.ts

# ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã§ãƒ†ã‚¹ãƒˆ
npm test "tests/unit/**/*.test.ts"

# çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npm test tests/integration/

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npm test tests/unit/
```

### ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰

```bash
# å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å†ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
npm test

# å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›£è¦–ã—ã¦å†ãƒ†ã‚¹ãƒˆ
npm test --coverage --watch
```

## ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ

### ã‚«ãƒãƒ¬ãƒƒã‚¸ç”Ÿæˆ

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
npm run test:coverage

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ãƒãƒ¬ãƒƒã‚¸
npm run test:coverage tests/unit/lib/uid.test.ts

# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
npm run test:coverage && open coverage/index.html
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç¨®é¡

#### 1. ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ï¼‰
```
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   96.62 |    95.65 |     100 |   96.62 |                   
 lib/uid.ts        |   96.62 |    95.65 |     100 |   96.62 | 129-130,143-144   
-------------------|---------|----------|---------|---------|-------------------
```

#### 2. HTMLãƒ¬ãƒãƒ¼ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºï¼‰
- **å ´æ‰€**: `coverage/index.html`
- **ç‰¹å¾´**: ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥è©³ç´°è¡¨ç¤ºã€æœªã‚«ãƒãƒ¼è¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- **é–‹ãæ–¹**: `open coverage/index.html` (macOS) / `start coverage/index.html` (Windows)

#### 3. JSONãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ©Ÿæ¢°å¯èª­ï¼‰
- **å ´æ‰€**: `coverage/coverage-final.json`
- **ç”¨é€”**: CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«é€£æº

### ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤

ç¾åœ¨ã®é–¾å€¤è¨­å®šï¼ˆ`vitest.config.ts`ï¼‰:
```typescript
thresholds: {
  global: {
    branches: 70,    // åˆ†å²ã‚«ãƒãƒ¬ãƒƒã‚¸
    functions: 80,   // é–¢æ•°ã‚«ãƒãƒ¬ãƒƒã‚¸
    lines: 80,       // è¡Œã‚«ãƒãƒ¬ãƒƒã‚¸
    statements: 80,  // æ–‡ã‚«ãƒãƒ¬ãƒƒã‚¸
  },
}
```

## ğŸ“ ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
tests/
â”œâ”€â”€ unit/                    # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ uid.test.ts     # UIDç®¡ç†æ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ auth.test.ts    # èªè¨¼æ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ schemas.test.ts # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â””â”€â”€ supabase.test.ts # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â””â”€â”€ components/         # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ integration/            # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ stories.test.ts # Stories API
â”œâ”€â”€ fixtures/               # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ test-data.ts       # å…±é€šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ helpers/               # ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â””â”€â”€ supabase-mock.ts   # Supabaseãƒ¢ãƒƒã‚¯
â””â”€â”€ utils/                 # ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â””â”€â”€ setup.ts          # ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
```

### ãƒ†ã‚¹ãƒˆã®å‘½åè¦å‰‡

- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: `[å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«å].test.ts`
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: `[æ©Ÿèƒ½å].test.ts`
- **E2Eãƒ†ã‚¹ãƒˆ**: `[ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼å].e2e.test.ts`

## ğŸ­ ãƒ¢ãƒƒã‚¯æ©Ÿèƒ½

### ç’°å¢ƒå¤‰æ•°ãƒ¢ãƒƒã‚¯

ãƒ†ã‚¹ãƒˆã§ã¯ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•è¨­å®šã•ã‚Œã¾ã™ï¼š
```javascript
env: {
  NEXT_PUBLIC_SUPABASE_URL: 'https://test.supabase.co',
  NEXT_PUBLIC_SUPABASE_ANON_KEY: 'test-anon-key',
  SUPABASE_SERVICE_ROLE_KEY: 'test-service-key',
}
```

### Supabaseãƒ¢ãƒƒã‚¯

```typescript
import { createMockSupabaseClient, mockStore } from '../../helpers/supabase-mock'

// ãƒ¢ãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½¿ç”¨
const client = createMockSupabaseClient()

// ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®š
mockStore.setData('stories', [MOCK_STORY])

// ãƒ‡ãƒ¼ã‚¿å–å¾—ç¢ºèª
const stories = mockStore.getData('stories')
```

### ãƒ–ãƒ©ã‚¦ã‚¶APIãƒ¢ãƒƒã‚¯

#### localStorage
```typescript
// ãƒ†ã‚¹ãƒˆå†…ã§è‡ªå‹•çš„ã«ãƒ¢ãƒƒã‚¯åŒ–
localStorage.setItem('test-key', 'test-value')
expect(localStorage.getItem('test-key')).toBe('test-value')
```

#### Cookie
```typescript
// documentã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚ãƒ¢ãƒƒã‚¯åŒ–æ¸ˆã¿
document.cookie = 'sessionId=abc123'
```

### OpenAI APIãƒ¢ãƒƒã‚¯

```typescript
import { vi } from 'vitest'

// OpenAI APIå¿œç­”ã‚’ãƒ¢ãƒƒã‚¯
const { generateMulmoscriptWithFallback } = await import('@/lib/openai-client')
vi.mocked(generateMulmoscriptWithFallback).mockResolvedValue({
  script: MOCK_GENERATED_SCRIPT,
  generated_with_ai: true,
})
```

## ğŸ” ãƒ‡ãƒãƒƒã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ

```bash
# ãƒ‡ãƒãƒƒã‚°æƒ…å ±ä»˜ãã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test -- --reporter=verbose

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ã¿å®Ÿè¡Œ
npm test -- --grep "should validate UID format"

# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã®å»¶é•·
npm test -- --timeout=30000
```

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•

#### 1. ãƒ¢ãƒƒã‚¯é–¢é€£ã‚¨ãƒ©ãƒ¼
```
Error: Cannot find module '@/lib/supabase'
```
**è§£æ±º**: ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®šã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ç›¸å¯¾ãƒ‘ã‚¹ã‚’ä½¿ç”¨

#### 2. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼
```
Test timeout after 10000ms
```
**è§£æ±º**: `vitest.config.ts`ã§`testTimeout`ã‚’èª¿æ•´

#### 3. ã‚«ãƒãƒ¬ãƒƒã‚¸ç”Ÿæˆã‚¨ãƒ©ãƒ¼
```
Error: Source map file not found
```
**è§£æ±º**: `.next`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é™¤å¤–è¨­å®šã«è¿½åŠ æ¸ˆã¿ï¼ˆè§£æ±ºæ¸ˆã¿ï¼‰

### ãƒ­ã‚°å‡ºåŠ›ã®ç¢ºèª

```bash
# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’å«ã‚€è©³ç´°å‡ºåŠ›
npm test -- --reporter=verbose --no-coverage

# ã‚¨ãƒ©ãƒ¼ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹è¡¨ç¤º
npm test -- --reporter=verbose --bail
```

## ğŸ”„ CI/CD ã§ã®ä½¿ç”¨

### GitHub Actions ã§ã®è¨­å®šä¾‹

```yaml
- name: Run tests with coverage
  run: npm run test:coverage

- name: Upload coverage reports
  uses: codecov/codecov-action@v3
  with:
    file: ./coverage/coverage-final.json
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ãƒã‚§ãƒƒã‚¯

```bash
# é–¾å€¤ã‚’æº€ãŸã•ãªã„å ´åˆã€ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—
npm run test:coverage

# é–¾å€¤ã‚’ä¸€æ™‚çš„ã«ç„¡è¦–
npm run test:coverage -- --coverage.thresholds.global.branches=50
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ä¸¦åˆ—å®Ÿè¡Œ

```bash
# è¤‡æ•°ãƒ¯ãƒ¼ã‚«ãƒ¼ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test -- --threads

# ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ã‚’æŒ‡å®š
npm test -- --threads --max-workers=4
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨

```bash
# Vitestã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
npm test -- --no-cache

# ä¾å­˜é–¢ä¿‚ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ã¦å®Ÿè¡Œ
npm test -- --changed
```

## ğŸ¯ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé »åº¦
- **é–‹ç™ºä¸­**: `npm test` ã§ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
- **PRãƒãƒ¼ã‚¸å‰**: `npm run test:coverage` ã§å®Œå…¨ãƒã‚§ãƒƒã‚¯
- **ãƒ‡ãƒ—ãƒ­ã‚¤å‰**: `npm run test:run` ã§æœ¬ç•ªç¢ºèª

### 2. ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- **æ–°æ©Ÿèƒ½**: 90%ä»¥ä¸Šã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç›®æŒ‡ã™
- **æ—¢å­˜ã‚³ãƒ¼ãƒ‰**: æ®µéšçš„ã«ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å‘ä¸Š
- **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«æ©Ÿèƒ½**: 100%ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¶­æŒ

### 3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†
- `tests/fixtures/test-data.ts`ã®å…±é€šãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨
- ãƒ†ã‚¹ãƒˆé–“ã§ã®ãƒ‡ãƒ¼ã‚¿å¹²æ¸‰ã‚’é¿ã‘ã‚‹
- å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«è¿‘ã„ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ†ã‚¹ãƒˆæ”¹å–„è¨ˆç”»](./improvement-plan.md)
- [å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](./implementation-checklist.md)
- [æŠ€è¡“ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯è©³ç´°](./framework.md)
- [ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§](./README.md)

---

**æ›´æ–°æ—¥**: 2024å¹´6æœˆ27æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0  
**æ‹…å½“**: Claude Code Assistant