# ScriptDirector V2 フラットシーン構造への変更計画

## 概要

現在の「幕・場」という階層構造から、シンプルでフラットな「シーン1〜シーンN」という構造に変更します。これにより、ユーザーにとってより直感的で柔軟なシーン管理が可能になります。

## 変更前後の比較

### 現在の構造（階層型）
```
5幕構成
├── 第1幕: 導入
│   ├── シーン1: 開幕
│   └── シーン2: 状況説明
├── 第2幕: 展開
│   ├── シーン3: 対立
│   └── シーン4: 葛藤
└── ...
```

### 新しい構造（フラット型）
```
シーンリスト（5シーン）
├── シーン1: タイトル
├── シーン2: タイトル
├── シーン3: タイトル
├── シーン4: タイトル
└── シーン5: タイトル
```

## データ構造の変更

### 1. MulmoScript形式との整合性

MulmoScriptは既にbeat（ビート）というフラット構造を使用しているため、UIとデータ構造を完全に一致させることができます。

**利点：**
- データ変換が不要
- MulmoScriptとの完全な互換性
- シンプルな実装

### 2. workflow_state.metadataの構造

```typescript
interface SceneListMetadata {
  scenes: Array<{
    id: string;
    title: string;
    description?: string;
    order: number;
  }>;
  totalScenes: number;
}
```

### 3. データベーススキーマ

既存の`beats`フィールド（1-20）はシーン数として継続使用します。幕の概念は削除し、シーンのみを管理します。

## UI/UXの変更

### ステップ2: シーン構成

**新しいレイアウト**
```
┌─────────────────────────────┐
│ ← 戻る        2/5         × │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━ │
├─────────────────────────────┤
│  🎬 シーン構成（5シーン）     │
│                             │
│ ┌─────────────────────────┐ │
│ │ シーン1                  │ │
│ │ タイトルを入力...        │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ シーン2                  │ │
│ │ タイトルを入力...        │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ シーン3                  │ │
│ │ タイトルを入力...        │ │
│ └─────────────────────────┘ │
│                             │
│ [+ シーンを追加]             │
├─────────────────────────────┤
│  [ ← 戻る ]    [ 次へ → ]   │
└─────────────────────────────┘
```

**インタラクション**
- 各シーンカードで直接タイトル編集
- ドラッグ&ドロップで順序変更
- 削除ボタン（最小1シーン必須）
- 「シーンを追加」ボタン（最大20シーン）

### メリット

1. **シンプルさ**: 幕の概念がなくなり、理解しやすい
2. **柔軟性**: シーン数を自由に調整可能
3. **直感的**: シーン番号で管理するため分かりやすい
4. **効率的**: 階層を意識する必要がない

## 実装フェーズ

### Phase 1: データ構造の更新
1. workflow_state.metadataの新しい型定義
2. シーン管理のためのhooks作成
3. MulmoScript変換ロジックの実装

### Phase 2: UIコンポーネントの更新
1. SceneListStepコンポーネントの簡素化
2. シーンカードコンポーネントの作成
3. ドラッグ&ドロップ機能の実装

### Phase 3: AI生成の調整
1. プロンプトをフラット構造に対応
2. シーン番号ベースの生成
3. 均等な幕分配ロジック

### Phase 4: 既存データの移行
1. 既存の幕・場データをフラット構造に変換
2. 後方互換性の確保

## 技術的考慮事項

### MulmoScriptとの統合

MulmoScriptは既にbeatベースのフラット構造のため、UIで管理するシーンをそのままbeatとして使用できます：

```typescript
// UI上のシーン = MulmoScriptのbeat
const scenes = [
  { id: '1', title: 'オープニング' },
  { id: '2', title: '出会い' },
  { id: '3', title: '葛藤' },
  { id: '4', title: '解決' },
  { id: '5', title: 'エンディング' }
];

// MulmoScript形式（変換不要）
const mulmoBeats = scenes.map((scene, index) => ({
  beat: index + 1,
  title: scene.title,
  // その他のMulmoScriptフィールド
}));
```

### ステート管理

```typescript
interface WorkflowSceneState {
  scenes: Scene[];
  activeSceneId: string | null;
  isDragging: boolean;
}

interface Scene {
  id: string;
  order: number;
  title: string;
  description?: string;
  // 将来的な拡張用
  duration?: number;
  location?: string;
}
```

## 次のステップ

1. このプランのレビューと承認
2. 詳細な技術仕様の作成
3. UIモックアップの作成
4. 段階的な実装開始