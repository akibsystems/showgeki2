# E2E Tests for Instant Mode

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ä¸€æ°—é€šè²«E2Eãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•

## æ¦‚è¦

ã“ã®E2Eãƒ†ã‚¹ãƒˆã¯ä»¥ä¸‹ã®å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼**: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³
2. **ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä½œæˆ**: `/api/instant/create` ã§ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰é–‹å§‹
3. **çŠ¶æ…‹ç›£è¦–**: `/api/instant/[id]/status` ã§ã®é€²æ—è¿½è·¡
4. **å‹•ç”»ç”Ÿæˆå®Œäº†**: å®Ÿéš›ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã¾ã§
5. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª**: é–¢é€£ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ•´åˆæ€§ç¢ºèª

## å®Ÿè¡Œæ–¹æ³•

### å‰ææ¡ä»¶

1. **Next.jsé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨**:
   ```bash
   npm run dev
   ```

2. **ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨**ï¼ˆ`.env.local`ï¼‰:
   ```env
   NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
   SUPABASE_SERVICE_KEY=your_service_key
   OPENAI_API_KEY=your_openai_key
   ```

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨**

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm run test:instant-e2e
```

### ç’°å¢ƒåˆ¥å®Ÿè¡Œ

```bash
# æœ¬ç•ªç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
TEST_BASE_URL=https://your-production-url.com npm run test:instant-e2e

# ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
npm run test:instant-e2e
```

## ãƒ†ã‚¹ãƒˆå†…å®¹

### 1. Complete Workflow Test
- **æ‰€è¦æ™‚é–“**: æœ€å¤§6åˆ†ï¼ˆå‹•ç”»ç”Ÿæˆå«ã‚€ï¼‰
- **ãƒ†ã‚¹ãƒˆå†…å®¹**:
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
  - ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä½œæˆAPIå‘¼ã³å‡ºã—
  - çŠ¶æ…‹ç›£è¦–ï¼ˆ5ç§’é–“éš”ã§ãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰
  - å‹•ç”»ç”Ÿæˆå®Œäº†ã¾ã§å¾…æ©Ÿ
  - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ç¢ºèª

### 2. Error Handling Tests
- **å­˜åœ¨ã—ãªã„ID**: 404ã‚¨ãƒ©ãƒ¼ã®ç¢ºèª
- **èªè¨¼ãªã—**: 401ã‚¨ãƒ©ãƒ¼ã®ç¢ºèª
- **å…¥åŠ›æ¤œè¨¼**: 400ã‚¨ãƒ©ãƒ¼ã®ç¢ºèª

## ãƒ­ã‚°å‡ºåŠ›ä¾‹

```
âœ… Test user authenticated: 12345678-1234-5678-9012-123456789abc
âœ… Instant generation created: instant-abc123
ğŸ“Š Status: processing, Step: analyzing, Progress: 10%
ğŸ“Š Status: processing, Step: script, Progress: 40%
ğŸ“Š Status: processing, Step: voices, Progress: 70%
ğŸ“Š Status: processing, Step: generating, Progress: 90%
âœ… Video generation completed: video-def456
âœ… Video record verified: { id: 'video-def456', status: 'completed', url: 'https://...' }
âœ… Instant generation record verified: { id: 'instant-abc123', status: 'completed' }
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 1. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼
```
Test timed out in 360000ms
```
- å‹•ç”»ç”Ÿæˆã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- OpenAI APIã®çŠ¶æ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„

### 2. èªè¨¼ã‚¨ãƒ©ãƒ¼
```
Failed to create test user: ...
```
- Supabaseã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„
- èªè¨¼è¨­å®šãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„

### 3. å‹•ç”»ç”Ÿæˆã‚¨ãƒ©ãƒ¼
```
Instant generation failed: ...
```
- OpenAI API keyãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- mulmocast-cliãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ­ã‚°ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèª

## æ³¨æ„äº‹é …

- ãƒ†ã‚¹ãƒˆã¯å®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹ï¼ˆOpenAI APIã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™
- APIä½¿ç”¨æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™
- ä¸¦è¡Œå®Ÿè¡Œã¯é¿ã‘ã¦ã€1ã¤ãšã¤å®Ÿè¡Œã—ã¦ãã ã•ã„